"use strict";
///<reference types="./libs/FudgeCore.js"/>
var f = FudgeCore;
var Turorials_FUDGEPhysics_Lesson1;
(function (Turorials_FUDGEPhysics_Lesson1) {
    window.addEventListener("load", init);
    const app = document.querySelector("canvas");
    let viewPort;
    let hierarchy;
    let environment = new Array();
    let player;
    let playerBody;
    let ball;
    let ballBody;
    //Setting Variables
    let materialPlayer = new f.Material("Player", f.ShaderFlat, new f.CoatColored(new f.Color(0.7, 0.8, 0.6, 1)));
    let materialBall = new f.Material("Ball", f.ShaderFlat, new f.CoatColored(new f.Color(0.8, 0.8, 0.2, 1)));
    let materialEnvironment = new f.Material("Environment", f.ShaderFlat, new f.CoatColored(new f.Color(0.2, 0.2, 0.2, 1)));
    let materialGoal = new f.Material("Goal", f.ShaderFlat, new f.CoatColored(new f.Color(0.5, 0.5, 0.5, 1)));
    //Physical Player Variables
    let isGrounded;
    let movementspeed = 12;
    let turningspeed = 200;
    let playerWeight = 75;
    let playerJumpForce = 500;
    let kickStrength = 100;
    let cmpCamera;
    let yTurn = 0;
    let forwardMovement = 0;
    function init(_event) {
        hierarchy = new f.Node("Scene");
        f.Physics.world.setSolverIterations(1000);
        f.Physics.settings.defaultRestitution = 0.3;
        f.Physics.settings.defaultFriction = 0.8;
        settingUpEnvironment();
        settingUpAPlayer();
        ball = createNodeWithComponents("Ball", materialBall, new f.MeshSphere(), 1, f.PHYSICS_TYPE.DYNAMIC, f.PHYSICS_GROUP.GROUP_2, f.COLLIDER_TYPE.SPHERE);
        ball.mtxLocal.translateY(2);
        ballBody = ball.getComponent(f.ComponentRigidbody);
        ballBody.restitution = 2.5;
        hierarchy.appendChild(ball);
        settingUpTrigger();
        settingUpAJoint();
        //Standard Fudge Scene Initialization - Creating a directional light, a camera and initialize the viewport
        let cmpLight = new f.ComponentLight(new f.LightDirectional(f.Color.CSS("WHITE")));
        cmpLight.mtxPivot.lookAt(new f.Vector3(0.5, -1, -0.8)); //Set light direction
        hierarchy.addComponent(cmpLight);
        cmpCamera = new f.ComponentCamera();
        cmpCamera.clrBackground = f.Color.CSS("GREY");
        cmpCamera.mtxPivot.translate(new f.Vector3(20, 10, 20));
        cmpCamera.mtxPivot.lookAt(f.Vector3.ZERO());
        viewPort = new f.Viewport();
        viewPort.initialize("Viewport", hierarchy, cmpCamera, app);
        document.addEventListener("keypress", handler_Key_Pressed);
        document.addEventListener("keyup", handler_Key_Released);
        //Ball Resetting on enter trigger
        environment[8].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, resetBall);
        environment[9].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, resetBall);
        // Implementing kicking mechanic
        document.addEventListener("keypress", (_event) => {
            if (_event.code == f.KEYBOARD_CODE.E) {
                let playerForward;
                playerForward = f.Vector3.Z();
                playerForward.transform(player.mtxWorld, false);
                let distance = f.Vector3.DIFFERENCE(ball.mtxWorld.translation, player.mtxWorld.translation);
                if (distance.magnitude > 2.5)
                    return;
                ballBody.applyImpulseAtPoint(new f.Vector3(playerForward.x * kickStrength / distance.magnitude, playerForward.y * kickStrength / distance.magnitude, playerForward.z * kickStrength / distance.magnitude), player.mtxWorld.translation);
            }
        });
        f.Physics.start(hierarchy);
        f.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update);
        f.Loop.start(); //Stard the game loop
    }
    function update() {
        f.Physics.world.simulate(f.Loop.timeFrameReal / 1000);
        cmpCamera.mtxPivot.lookAt(player.mtxWorld.translation);
        playerIsGroundedRaycast();
        player_Movement(f.Loop.timeFrameReal / 1000);
        viewPort.draw();
    }
    function createNodeWithComponents(_name, _material, _mesh, _mass, _physicsType, _group = f.PHYSICS_GROUP.DEFAULT, _colType = f.COLLIDER_TYPE.CUBE, _convexMesh = null) {
        let node = new f.Node(_name);
        let cmpMesh = new f.ComponentMesh(_mesh);
        let cmpMaterial = new f.ComponentMaterial(_material);
        let cmpTransform = new f.ComponentTransform();
        let cmpRigidbody = new f.ComponentRigidbody(_mass, _physicsType, _colType, _group, null, _convexMesh); //add a Float32 Array of points to the rb constructor to create a convex collider
        node.addComponent(cmpMesh);
        node.addComponent(cmpMaterial);
        node.addComponent(cmpTransform);
        node.addComponent(cmpRigidbody);
        return node;
    }
    function settingUpAPlayer() {
        player = createNodeWithComponents("Player", materialPlayer, new f.MeshCube(), playerWeight, f.PHYSICS_TYPE.DYNAMIC, f.PHYSICS_GROUP.DEFAULT, f.COLLIDER_TYPE.CAPSULE);
        hierarchy.appendChild(player);
        playerBody = player.getComponent(f.ComponentRigidbody);
        player.mtxLocal.scale(new f.Vector3(0.5, 1.8, 0.3));
        player.mtxLocal.translate(new f.Vector3(2.5, 4, 3.5));
        playerBody.rotationInfluenceFactor = new f.Vector3(0, 0, 0);
        playerBody.mtxPivot.scale(new f.Vector3(1, 0.85, 1));
        playerBody.friction = 0.01;
        // Nose as direction indicator
        let playerNose = createNodeWithComponents("PlayerNose", materialPlayer, new f.MeshCube(), playerWeight, f.PHYSICS_TYPE.DYNAMIC);
        playerNose.mtxLocal.translate(new f.Vector3(0, 0.2, 0.4));
        playerNose.mtxLocal.scale(new f.Vector3(0.1, 0.2, 1.5));
        playerNose.removeComponent(playerNose.getComponent(f.ComponentRigidbody));
        player.addChild(playerNose);
    }
    function playerIsGroundedRaycast() {
        let hitInfo;
        hitInfo = f.Physics.raycast(playerBody.getPosition(), new f.Vector3(0, -1, 0), 1.1);
        if (hitInfo.hit) {
            isGrounded = true;
        }
        else {
            isGrounded = false;
        }
    }
    function handler_Key_Pressed(_event) {
        if (_event.code == f.KEYBOARD_CODE.A) {
            yTurn = 1;
        }
        if (_event.code == f.KEYBOARD_CODE.W) {
            forwardMovement = 1;
        }
        if (_event.code == f.KEYBOARD_CODE.S) {
            forwardMovement = -1;
        }
        if (_event.code == f.KEYBOARD_CODE.D) {
            yTurn = -1;
        }
        if (_event.code == f.KEYBOARD_CODE.SPACE) {
            if (isGrounded)
                playerBody.applyLinearImpulse(new f.Vector3(0, playerJumpForce, 0));
        }
        if (_event.code == f.KEYBOARD_CODE.T) {
            f.Physics.settings.debugMode = f.Physics.settings.debugMode == f.PHYSICS_DEBUGMODE.JOINTS_AND_COLLIDER ? f.PHYSICS_DEBUGMODE.PHYSIC_OBJECTS_ONLY : f.PHYSICS_DEBUGMODE.JOINTS_AND_COLLIDER;
        }
        if (_event.code == f.KEYBOARD_CODE.Y) {
            f.Physics.settings.debugDraw = !f.Physics.settings.debugDraw;
        }
    }
    function handler_Key_Released(_event) {
        if (_event.code == f.KEYBOARD_CODE.A) {
            yTurn = 0;
        }
        if (_event.code == f.KEYBOARD_CODE.W) {
            forwardMovement = 0;
        }
        if (_event.code == f.KEYBOARD_CODE.S) {
            forwardMovement = 0;
        }
        if (_event.code == f.KEYBOARD_CODE.D) {
            yTurn = 0;
        }
    }
    //Actually moving the player
    function player_Movement(_deltaTime) {
        let playerForward;
        playerForward = f.Vector3.Z();
        playerForward.transform(player.mtxWorld, false);
        //You can rotate a body like you would rotate a transform, incremental but keep in mind, normally we use forces in physics,
        //this is just a feature to make it easier to create player characters
        playerBody.rotateBody(new f.Vector3(0, yTurn * turningspeed * _deltaTime, 0));
        let movementVelocity = new f.Vector3();
        movementVelocity.x = playerForward.x * forwardMovement * movementspeed;
        movementVelocity.y = playerBody.getVelocity().y;
        movementVelocity.z = playerForward.z * forwardMovement * movementspeed;
        playerBody.setVelocity(movementVelocity);
    }
    function settingUpEnvironment() {
        environment[0] = createNodeWithComponents("Ground", materialEnvironment, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[0].mtxLocal.scale(new f.Vector3(20, 0.3, 20));
        hierarchy.appendChild(environment[0]);
        //Protective Walls
        environment[1] = createNodeWithComponents("FrontWall", materialEnvironment, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[1].mtxLocal.scale(new f.Vector3(20, 1, 1));
        environment[1].mtxLocal.translate(new f.Vector3(0, 0.5, 10.5));
        hierarchy.appendChild(environment[1]);
        environment[2] = createNodeWithComponents("BackWall", materialEnvironment, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[2].mtxLocal.scale(new f.Vector3(20, 1, 1));
        environment[2].mtxLocal.translate(new f.Vector3(0, 0.5, -10.5));
        hierarchy.appendChild(environment[2]);
        environment[3] = createNodeWithComponents("LeftWall", materialEnvironment, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[3].mtxLocal.scale(new f.Vector3(1, 1, 20));
        environment[3].mtxLocal.translate(new f.Vector3(10.5, 0.5, 0));
        hierarchy.appendChild(environment[3]);
        environment[4] = createNodeWithComponents("RightWall", materialEnvironment, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[4].mtxLocal.scale(new f.Vector3(1, 1, 20));
        environment[4].mtxLocal.translate(new f.Vector3(-10.5, 0.5, 0));
        hierarchy.appendChild(environment[4]);
        //Goal
        environment[5] = createNodeWithComponents("Goal_Upper", materialGoal, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[5].mtxLocal.scale(new f.Vector3(8, 1, 1));
        environment[5].mtxLocal.translate(new f.Vector3(0, 4.5, -9.5));
        hierarchy.appendChild(environment[5]);
        environment[6] = createNodeWithComponents("Goal_Left", materialGoal, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[6].mtxLocal.scale(new f.Vector3(1, 4.5, 1));
        environment[6].mtxLocal.translate(new f.Vector3(-4.5, 0.5, -9.5));
        hierarchy.appendChild(environment[6]);
        environment[7] = createNodeWithComponents("Goal_Right", materialGoal, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_2);
        environment[7].mtxLocal.scale(new f.Vector3(1, 4.5, 1));
        environment[7].mtxLocal.translate(new f.Vector3(4.5, 0.5, -9.5));
        hierarchy.appendChild(environment[7]);
    }
    function settingUpTrigger() {
        // Ball Resetting Triggers
        environment[8] = createNodeWithComponents("Ground_BelowZero", materialGoal, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        environment[8].removeComponent(environment[8].getComponent(f.ComponentMesh));
        environment[8].mtxLocal.scale(new f.Vector3(100, 10, 100));
        environment[8].mtxLocal.translateY(-1);
        hierarchy.appendChild(environment[8]);
        environment[9] = createNodeWithComponents("Goal_Trigger", materialGoal, new f.MeshCube(), 0, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.TRIGGER);
        environment[9].removeComponent(environment[9].getComponent(f.ComponentMesh));
        environment[9].mtxLocal.scale(new f.Vector3(9, 4.5, 1.5));
        environment[9].mtxLocal.translate(new f.Vector3(0, 0.5, -6.25));
        hierarchy.appendChild(environment[9]);
    }
    function resetBall(_event) {
        if (_event.cmpRigidbody.getContainer().name == "Ball") {
            ballBody.setVelocity(f.Vector3.ZERO());
            ballBody.setAngularVelocity(f.Vector3.ZERO());
            ballBody.setPosition(new f.Vector3(0, 5, 0));
        }
    }
    function settingUpAJoint() {
        environment[10] = createNodeWithComponents("Holder", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(0.4, 0.4, 0.4, 1))), new f.MeshCube(), 1, f.PHYSICS_TYPE.STATIC, f.PHYSICS_GROUP.GROUP_1);
        hierarchy.appendChild(environment[10]);
        environment[10].mtxLocal.translate(new f.Vector3(5, 6, -2));
        environment[10].mtxLocal.scale(new f.Vector3(0.5, 1, 0.5));
        environment[11] = createNodeWithComponents("MovingDrill", new f.Material("Cube", f.ShaderFlat, new f.CoatColored(new f.Color(1, 1, 0, 1))), new f.MeshCube(), 1, f.PHYSICS_TYPE.DYNAMIC, f.PHYSICS_GROUP.GROUP_1);
        hierarchy.appendChild(environment[11]);
        environment[11].mtxLocal.translate(new f.Vector3(5, 2.5, -2));
        environment[11].mtxLocal.scale(new f.Vector3(3, 2, 0.2));
        let cylindricalJoint = new f.ComponentJointCylindrical(environment[10].getComponent(f.ComponentRigidbody), environment[11].getComponent(f.ComponentRigidbody), new f.Vector3(0, 1, 0));
        environment[11].addComponent(cylindricalJoint);
        cylindricalJoint.translationMotorLimitLower = -1;
        cylindricalJoint.translationMotorLimitUpper = 0;
    }
})(Turorials_FUDGEPhysics_Lesson1 || (Turorials_FUDGEPhysics_Lesson1 = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDJDQUEyQztBQUUzQyxJQUFPLENBQUMsR0FBRyxTQUFTLENBQUM7QUFFckIsSUFBVSw4QkFBOEIsQ0FvU3ZDO0FBcFNELFdBQVUsOEJBQThCO0lBR3BDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdEMsTUFBTSxHQUFHLEdBQXNCLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDaEUsSUFBSSxRQUFvQixDQUFDO0lBQ3pCLElBQUksU0FBaUIsQ0FBQztJQUV0QixJQUFJLFdBQVcsR0FBYSxJQUFJLEtBQUssRUFBRSxDQUFDO0lBQ3hDLElBQUksTUFBYyxDQUFDO0lBQ25CLElBQUksVUFBZ0MsQ0FBQztJQUNyQyxJQUFJLElBQVksQ0FBQztJQUNqQixJQUFJLFFBQThCLENBQUM7SUFFbkMsbUJBQW1CO0lBQ25CLElBQUksY0FBYyxHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxSCxJQUFJLFlBQVksR0FBZSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEgsSUFBSSxtQkFBbUIsR0FBZSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FB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R0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEUsU0FBUyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0QyxNQUFNO1FBQ04sV0FBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLHdCQUF3QixDQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsSUFBSSxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDM0ksV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RCxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDL0QsU0FBUyxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV0QyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsd0JBQXdCLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxSSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hELFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FB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QixDQUFDLDBCQUEwQixHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2pELGdCQUFnQixDQUFDLDBCQUEwQixHQUFHLENBQUMsQ0FBQztJQUNwRCxDQUFDO0FBQ0wsQ0FBQyxFQXBTUyw4QkFBOEIsS0FBOUIsOEJBQThCLFFBb1N2QyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgdHlwZXM9XCIuL2xpYnMvRnVkZ2VDb3JlLmpzXCIvPlxyXG5cclxuaW1wb3J0IGYgPSBGdWRnZUNvcmU7XHJcblxyXG5uYW1lc3BhY2UgVHVyb3JpYWxzX0ZVREdFUGh5c2ljc19MZXNzb24xIHtcclxuXHJcblxyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGluaXQpO1xyXG4gICAgY29uc3QgYXBwOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIik7XHJcbiAgICBsZXQgdmlld1BvcnQ6IGYuVmlld3BvcnQ7XHJcbiAgICBsZXQgaGllcmFyY2h5OiBmLk5vZGU7XHJcblxyXG4gICAgbGV0IGVudmlyb25tZW50OiBmLk5vZGVbXSA9IG5ldyBBcnJheSgpO1xyXG4gICAgbGV0IHBsYXllcjogZi5Ob2RlO1xyXG4gICAgbGV0IHBsYXllckJvZHk6IGYuQ29tcG9uZW50UmlnaWRib2R5O1xyXG4gICAgbGV0IGJhbGw6IGYuTm9kZTtcclxuICAgIGxldCBiYWxsQm9keTogZi5Db21wb25lbnRSaWdpZGJvZHk7XHJcblxyXG4gICAgLy9TZXR0aW5nIFZhcmlhYmxlc1xyXG4gICAgbGV0IG1hdGVyaWFsUGxheWVyOiBmLk1hdGVyaWFsID0gbmV3IGYuTWF0ZXJpYWwoXCJQbGF5ZXJcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjcsIDAuOCwgMC42LCAxKSkpO1xyXG4gICAgbGV0IG1hdGVyaWFsQmFsbDogZi5NYXRlcmlhbCA9IG5ldyBmLk1hdGVyaWFsKFwiQmFsbFwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRDb2xvcmVkKG5ldyBmLkNvbG9yKDAuOCwgMC44LCAwLjIsIDEpKSk7XHJcbiAgICBsZXQgbWF0ZXJpYWxFbnZpcm9ubWVudDogZi5NYXRlcmlhbCA9IG5ldyBmLk1hdGVyaWFsKFwiRW52aXJvbm1lbnRcIiwgZi5TaGFkZXJGbGF0LCBuZXcgZi5Db2F0Q29sb3JlZChuZXcgZi5Db2xvcigwLjIsIDAuMiwgMC4yLCAxKSkpO1xyXG4gICAgbGV0IG1hdGVyaWFsR29hbDogZi5NYXRlcmlhbCA9IG5ldyBmLk1hdGVyaWFsKFwiR29hbFwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRDb2xvcmVkKG5ldyBmLkNvbG9yKDAuNSwgMC41LCAwLjUsIDEpKSk7XHJcblxyXG4gICAgLy9QaHlzaWNhbCBQbGF5ZXIgVmFyaWFibGVzXHJcbiAgICBsZXQgaXNHcm91bmRlZDogYm9vbGVhbjtcclxuICAgIGxldCBtb3ZlbWVudHNwZWVkOiBudW1iZXIgPSAxMjtcclxuICAgIGxldCB0dXJuaW5nc3BlZWQ6IG51bWJlciA9IDIwMDtcclxuICAgIGxldCBwbGF5ZXJXZWlnaHQ6IG51bWJlciA9IDc1O1xyXG4gICAgbGV0IHBsYXllckp1bXBGb3JjZTogbnVtYmVyID0gNTAwO1xyXG4gICAgbGV0IGtpY2tTdHJlbmd0aDogbnVtYmVyID0gMTAwO1xyXG4gICAgbGV0IGNtcENhbWVyYTogZi5Db21wb25lbnRDYW1lcmE7XHJcbiAgICBsZXQgeVR1cm46IG51bWJlciA9IDA7XHJcbiAgICBsZXQgZm9yd2FyZE1vdmVtZW50OiBudW1iZXIgPSAwO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBpbml0KF9ldmVudDogRXZlbnQpOiB2b2lkIHtcclxuICAgICAgICBoaWVyYXJjaHkgPSBuZXcgZi5Ob2RlKFwiU2NlbmVcIik7XHJcblxyXG4gICAgICAgIGYuUGh5c2ljcy53b3JsZC5zZXRTb2x2ZXJJdGVyYXRpb25zKDEwMDApO1xyXG4gICAgICAgIGYuUGh5c2ljcy5zZXR0aW5ncy5kZWZhdWx0UmVzdGl0dXRpb24gPSAwLjM7XHJcbiAgICAgICAgZi5QaHlzaWNzLnNldHRpbmdzLmRlZmF1bHRGcmljdGlvbiA9IDAuODtcclxuXHJcbiAgICAgICAgc2V0dGluZ1VwRW52aXJvbm1lbnQoKTtcclxuXHJcbiAgICAgICAgc2V0dGluZ1VwQVBsYXllcigpO1xyXG5cclxuICAgICAgICBiYWxsID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiQmFsbFwiLCBtYXRlcmlhbEJhbGwsIG5ldyBmLk1lc2hTcGhlcmUoKSwgMSwgZi5QSFlTSUNTX1RZUEUuRFlOQU1JQyxcclxuICAgICAgICAgICAgZi5QSFlTSUNTX0dST1VQLkdST1VQXzIsIGYuQ09MTElERVJfVFlQRS5TUEhFUkUpO1xyXG5cclxuICAgICAgICBiYWxsLm10eExvY2FsLnRyYW5zbGF0ZVkoMik7XHJcbiAgICAgICAgYmFsbEJvZHkgPSBiYWxsLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSk7XHJcbiAgICAgICAgYmFsbEJvZHkucmVzdGl0dXRpb24gPSAyLjU7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGJhbGwpO1xyXG5cclxuICAgICAgICBzZXR0aW5nVXBUcmlnZ2VyKCk7XHJcblxyXG4gICAgICAgIHNldHRpbmdVcEFKb2ludCgpO1xyXG5cclxuICAgICAgICAvL1N0YW5kYXJkIEZ1ZGdlIFNjZW5lIEluaXRpYWxpemF0aW9uIC0gQ3JlYXRpbmcgYSBkaXJlY3Rpb25hbCBsaWdodCwgYSBjYW1lcmEgYW5kIGluaXRpYWxpemUgdGhlIHZpZXdwb3J0XHJcbiAgICAgICAgbGV0IGNtcExpZ2h0OiBmLkNvbXBvbmVudExpZ2h0ID0gbmV3IGYuQ29tcG9uZW50TGlnaHQobmV3IGYuTGlnaHREaXJlY3Rpb25hbChmLkNvbG9yLkNTUyhcIldISVRFXCIpKSk7XHJcbiAgICAgICAgY21wTGlnaHQubXR4UGl2b3QubG9va0F0KG5ldyBmLlZlY3RvcjMoMC41LCAtMSwgLTAuOCkpOyAvL1NldCBsaWdodCBkaXJlY3Rpb25cclxuICAgICAgICBoaWVyYXJjaHkuYWRkQ29tcG9uZW50KGNtcExpZ2h0KTtcclxuXHJcbiAgICAgICAgY21wQ2FtZXJhID0gbmV3IGYuQ29tcG9uZW50Q2FtZXJhKCk7XHJcbiAgICAgICAgY21wQ2FtZXJhLmNsckJhY2tncm91bmQgPSBmLkNvbG9yLkNTUyhcIkdSRVlcIik7XHJcbiAgICAgICAgY21wQ2FtZXJhLm10eFBpdm90LnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDIwLCAxMCwgMjApKTtcclxuICAgICAgICBjbXBDYW1lcmEubXR4UGl2b3QubG9va0F0KGYuVmVjdG9yMy5aRVJPKCkpO1xyXG5cclxuICAgICAgICB2aWV3UG9ydCA9IG5ldyBmLlZpZXdwb3J0KCk7XHJcbiAgICAgICAgdmlld1BvcnQuaW5pdGlhbGl6ZShcIlZpZXdwb3J0XCIsIGhpZXJhcmNoeSwgY21wQ2FtZXJhLCBhcHApO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5cHJlc3NcIiwgaGFuZGxlcl9LZXlfUHJlc3NlZCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGhhbmRsZXJfS2V5X1JlbGVhc2VkKTtcclxuXHJcbiAgICAgICAgLy9CYWxsIFJlc2V0dGluZyBvbiBlbnRlciB0cmlnZ2VyXHJcbiAgICAgICAgZW52aXJvbm1lbnRbOF0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5UUklHR0VSX0VOVEVSLCByZXNldEJhbGwpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzldLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuVFJJR0dFUl9FTlRFUiwgcmVzZXRCYWxsKTtcclxuXHJcbiAgICAgICAgLy8gSW1wbGVtZW50aW5nIGtpY2tpbmcgbWVjaGFuaWNcclxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5cHJlc3NcIiwgKF9ldmVudDogZi5FdmVudEtleWJvYXJkKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuRSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHBsYXllckZvcndhcmQ6IGYuVmVjdG9yMztcclxuICAgICAgICAgICAgICAgIHBsYXllckZvcndhcmQgPSBmLlZlY3RvcjMuWigpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyRm9yd2FyZC50cmFuc2Zvcm0ocGxheWVyLm10eFdvcmxkLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSBmLlZlY3RvcjMuRElGRkVSRU5DRShiYWxsLm10eFdvcmxkLnRyYW5zbGF0aW9uLCBwbGF5ZXIubXR4V29ybGQudHJhbnNsYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlLm1hZ25pdHVkZSA+IDIuNSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICBiYWxsQm9keS5hcHBseUltcHVsc2VBdFBvaW50KFxyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBmLlZlY3RvcjMocGxheWVyRm9yd2FyZC54ICoga2lja1N0cmVuZ3RoIC8gZGlzdGFuY2UubWFnbml0dWRlLCBwbGF5ZXJGb3J3YXJkLnkgKiBraWNrU3RyZW5ndGggLyBkaXN0YW5jZS5tYWduaXR1ZGUsIHBsYXllckZvcndhcmQueiAqIGtpY2tTdHJlbmd0aCAvIGRpc3RhbmNlLm1hZ25pdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyLm10eFdvcmxkLnRyYW5zbGF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmLlBoeXNpY3Muc3RhcnQoaGllcmFyY2h5KTtcclxuXHJcbiAgICAgICAgZi5Mb29wLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVC5MT09QX0ZSQU1FLCB1cGRhdGUpO1xyXG4gICAgICAgIGYuTG9vcC5zdGFydCgpOyAvL1N0YXJkIHRoZSBnYW1lIGxvb3BcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGUoKTogdm9pZCB7XHJcblxyXG4gICAgICAgIGYuUGh5c2ljcy53b3JsZC5zaW11bGF0ZShmLkxvb3AudGltZUZyYW1lUmVhbCAvIDEwMDApO1xyXG5cclxuICAgICAgICBjbXBDYW1lcmEubXR4UGl2b3QubG9va0F0KHBsYXllci5tdHhXb3JsZC50cmFuc2xhdGlvbik7XHJcbiAgICAgICAgcGxheWVySXNHcm91bmRlZFJheWNhc3QoKTtcclxuICAgICAgICBwbGF5ZXJfTW92ZW1lbnQoZi5Mb29wLnRpbWVGcmFtZVJlYWwgLyAxMDAwKTtcclxuXHJcbiAgICAgICAgdmlld1BvcnQuZHJhdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZU5vZGVXaXRoQ29tcG9uZW50cyhfbmFtZTogc3RyaW5nLCBfbWF0ZXJpYWw6IGYuTWF0ZXJpYWwsIF9tZXNoOiBmLk1lc2gsIF9tYXNzOiBudW1iZXIsIF9waHlzaWNzVHlwZTogZi5QSFlTSUNTX1RZUEUsIF9ncm91cDogZi5QSFlTSUNTX0dST1VQID0gZi5QSFlTSUNTX0dST1VQLkRFRkFVTFQsIF9jb2xUeXBlOiBmLkNPTExJREVSX1RZUEUgPSBmLkNPTExJREVSX1RZUEUuQ1VCRSwgX2NvbnZleE1lc2g6IEZsb2F0MzJBcnJheSA9IG51bGwpOiBmLk5vZGUge1xyXG4gICAgICAgIGxldCBub2RlOiBmLk5vZGUgPSBuZXcgZi5Ob2RlKF9uYW1lKTtcclxuICAgICAgICBsZXQgY21wTWVzaDogZi5Db21wb25lbnRNZXNoID0gbmV3IGYuQ29tcG9uZW50TWVzaChfbWVzaCk7XHJcbiAgICAgICAgbGV0IGNtcE1hdGVyaWFsOiBmLkNvbXBvbmVudE1hdGVyaWFsID0gbmV3IGYuQ29tcG9uZW50TWF0ZXJpYWwoX21hdGVyaWFsKTtcclxuXHJcbiAgICAgICAgbGV0IGNtcFRyYW5zZm9ybTogZi5Db21wb25lbnRUcmFuc2Zvcm0gPSBuZXcgZi5Db21wb25lbnRUcmFuc2Zvcm0oKTtcclxuICAgICAgICBsZXQgY21wUmlnaWRib2R5OiBmLkNvbXBvbmVudFJpZ2lkYm9keSA9IG5ldyBmLkNvbXBvbmVudFJpZ2lkYm9keShfbWFzcywgX3BoeXNpY3NUeXBlLCBfY29sVHlwZSwgX2dyb3VwLCBudWxsLCBfY29udmV4TWVzaCk7IC8vYWRkIGEgRmxvYXQzMiBBcnJheSBvZiBwb2ludHMgdG8gdGhlIHJiIGNvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIGNvbnZleCBjb2xsaWRlclxyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcE1lc2gpO1xyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcE1hdGVyaWFsKTtcclxuICAgICAgICBub2RlLmFkZENvbXBvbmVudChjbXBUcmFuc2Zvcm0pO1xyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcFJpZ2lkYm9keSk7XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0dGluZ1VwQVBsYXllcigpOiB2b2lkIHtcclxuICAgICAgICBwbGF5ZXIgPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJQbGF5ZXJcIiwgbWF0ZXJpYWxQbGF5ZXIsIG5ldyBmLk1lc2hDdWJlKCksIHBsYXllcldlaWdodCwgZi5QSFlTSUNTX1RZUEUuRFlOQU1JQywgZi5QSFlTSUNTX0dST1VQLkRFRkFVTFQsIGYuQ09MTElERVJfVFlQRS5DQVBTVUxFKTtcclxuICAgICAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQocGxheWVyKTtcclxuICAgICAgICBwbGF5ZXJCb2R5ID0gcGxheWVyLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSk7XHJcbiAgICAgICAgcGxheWVyLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMC41LCAxLjgsIDAuMykpO1xyXG4gICAgICAgIHBsYXllci5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygyLjUsIDQsIDMuNSkpO1xyXG4gICAgICAgIHBsYXllckJvZHkucm90YXRpb25JbmZsdWVuY2VGYWN0b3IgPSBuZXcgZi5WZWN0b3IzKDAsIDAsIDApO1xyXG4gICAgICAgIHBsYXllckJvZHkubXR4UGl2b3Quc2NhbGUobmV3IGYuVmVjdG9yMygxLCAwLjg1LCAxKSk7XHJcbiAgICAgICAgcGxheWVyQm9keS5mcmljdGlvbiA9IDAuMDE7XHJcblxyXG4gICAgICAgIC8vIE5vc2UgYXMgZGlyZWN0aW9uIGluZGljYXRvclxyXG4gICAgICAgIGxldCBwbGF5ZXJOb3NlOiBmLk5vZGUgPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJQbGF5ZXJOb3NlXCIsIG1hdGVyaWFsUGxheWVyLCBuZXcgZi5NZXNoQ3ViZSgpLCBwbGF5ZXJXZWlnaHQsIGYuUEhZU0lDU19UWVBFLkRZTkFNSUMpO1xyXG4gICAgICAgIHBsYXllck5vc2UubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMCwgMC4yLCAwLjQpKTtcclxuICAgICAgICBwbGF5ZXJOb3NlLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMC4xLCAwLjIsIDEuNSkpO1xyXG4gICAgICAgIHBsYXllck5vc2UucmVtb3ZlQ29tcG9uZW50KHBsYXllck5vc2UuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KSk7XHJcbiAgICAgICAgcGxheWVyLmFkZENoaWxkKHBsYXllck5vc2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBsYXllcklzR3JvdW5kZWRSYXljYXN0KCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBoaXRJbmZvOiBmLlJheUhpdEluZm87XHJcbiAgICAgICAgaGl0SW5mbyA9IGYuUGh5c2ljcy5yYXljYXN0KHBsYXllckJvZHkuZ2V0UG9zaXRpb24oKSwgbmV3IGYuVmVjdG9yMygwLCAtMSwgMCksIDEuMSk7XHJcbiAgICAgICAgaWYgKGhpdEluZm8uaGl0KSB7XHJcbiAgICAgICAgICAgIGlzR3JvdW5kZWQgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlzR3JvdW5kZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIGhhbmRsZXJfS2V5X1ByZXNzZWQoX2V2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XHJcblxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuQSkge1xyXG4gICAgICAgICAgICB5VHVybiA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuVykge1xyXG4gICAgICAgICAgICBmb3J3YXJkTW92ZW1lbnQgPSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLlMpIHtcclxuICAgICAgICAgICAgZm9yd2FyZE1vdmVtZW50ID0gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuRCkge1xyXG4gICAgICAgICAgICB5VHVybiA9IC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLlNQQUNFKSB7XHJcbiAgICAgICAgICAgIGlmIChpc0dyb3VuZGVkKVxyXG4gICAgICAgICAgICAgICAgcGxheWVyQm9keS5hcHBseUxpbmVhckltcHVsc2UobmV3IGYuVmVjdG9yMygwLCBwbGF5ZXJKdW1wRm9yY2UsIDApKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuVCkge1xyXG4gICAgICAgICAgICBmLlBoeXNpY3Muc2V0dGluZ3MuZGVidWdNb2RlID0gZi5QaHlzaWNzLnNldHRpbmdzLmRlYnVnTW9kZSA9PSBmLlBIWVNJQ1NfREVCVUdNT0RFLkpPSU5UU19BTkRfQ09MTElERVIgPyBmLlBIWVNJQ1NfREVCVUdNT0RFLlBIWVNJQ19PQkpFQ1RTX09OTFkgOiBmLlBIWVNJQ1NfREVCVUdNT0RFLkpPSU5UU19BTkRfQ09MTElERVI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuWSkge1xyXG4gICAgICAgICAgICBmLlBoeXNpY3Muc2V0dGluZ3MuZGVidWdEcmF3ID0gIWYuUGh5c2ljcy5zZXR0aW5ncy5kZWJ1Z0RyYXc7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGhhbmRsZXJfS2V5X1JlbGVhc2VkKF9ldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuQSkge1xyXG4gICAgICAgICAgICB5VHVybiA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuVykge1xyXG4gICAgICAgICAgICBmb3J3YXJkTW92ZW1lbnQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLlMpIHtcclxuICAgICAgICAgICAgZm9yd2FyZE1vdmVtZW50ID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5EKSB7XHJcbiAgICAgICAgICAgIHlUdXJuID0gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy9BY3R1YWxseSBtb3ZpbmcgdGhlIHBsYXllclxyXG4gICAgZnVuY3Rpb24gcGxheWVyX01vdmVtZW50KF9kZWx0YVRpbWU6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBwbGF5ZXJGb3J3YXJkOiBmLlZlY3RvcjM7XHJcbiAgICAgICAgcGxheWVyRm9yd2FyZCA9IGYuVmVjdG9yMy5aKCk7XHJcbiAgICAgICAgcGxheWVyRm9yd2FyZC50cmFuc2Zvcm0ocGxheWVyLm10eFdvcmxkLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vWW91IGNhbiByb3RhdGUgYSBib2R5IGxpa2UgeW91IHdvdWxkIHJvdGF0ZSBhIHRyYW5zZm9ybSwgaW5jcmVtZW50YWwgYnV0IGtlZXAgaW4gbWluZCwgbm9ybWFsbHkgd2UgdXNlIGZvcmNlcyBpbiBwaHlzaWNzLFxyXG4gICAgICAgIC8vdGhpcyBpcyBqdXN0IGEgZmVhdHVyZSB0byBtYWtlIGl0IGVhc2llciB0byBjcmVhdGUgcGxheWVyIGNoYXJhY3RlcnNcclxuICAgICAgICBwbGF5ZXJCb2R5LnJvdGF0ZUJvZHkobmV3IGYuVmVjdG9yMygwLCB5VHVybiAqIHR1cm5pbmdzcGVlZCAqIF9kZWx0YVRpbWUsIDApKTtcclxuXHJcbiAgICAgICAgbGV0IG1vdmVtZW50VmVsb2NpdHk6IGYuVmVjdG9yMyA9IG5ldyBmLlZlY3RvcjMoKTtcclxuICAgICAgICBtb3ZlbWVudFZlbG9jaXR5LnggPSBwbGF5ZXJGb3J3YXJkLnggKiBmb3J3YXJkTW92ZW1lbnQgKiBtb3ZlbWVudHNwZWVkO1xyXG4gICAgICAgIG1vdmVtZW50VmVsb2NpdHkueSA9IHBsYXllckJvZHkuZ2V0VmVsb2NpdHkoKS55O1xyXG4gICAgICAgIG1vdmVtZW50VmVsb2NpdHkueiA9IHBsYXllckZvcndhcmQueiAqIGZvcndhcmRNb3ZlbWVudCAqIG1vdmVtZW50c3BlZWQ7XHJcbiAgICAgICAgcGxheWVyQm9keS5zZXRWZWxvY2l0eShtb3ZlbWVudFZlbG9jaXR5KTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHNldHRpbmdVcEVudmlyb25tZW50KCkge1xyXG4gICAgICAgIGVudmlyb25tZW50WzBdID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiR3JvdW5kXCIsIG1hdGVyaWFsRW52aXJvbm1lbnQsIG5ldyBmLk1lc2hDdWJlKCksIDAsIGYuUEhZU0lDU19UWVBFLlNUQVRJQywgZi5QSFlTSUNTX0dST1VQLkdST1VQXzIpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzBdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMjAsIDAuMywgMjApKTtcclxuICAgICAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoZW52aXJvbm1lbnRbMF0pO1xyXG5cclxuICAgICAgICAvL1Byb3RlY3RpdmUgV2FsbHNcclxuICAgICAgICBlbnZpcm9ubWVudFsxXSA9IGNyZWF0ZU5vZGVXaXRoQ29tcG9uZW50cyhcIkZyb250V2FsbFwiLCBtYXRlcmlhbEVudmlyb25tZW50LCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5HUk9VUF8yKTtcclxuICAgICAgICBlbnZpcm9ubWVudFsxXS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDIwLCAxLCAxKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMV0ubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMCwgMC41LCAxMC41KSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzFdKTtcclxuXHJcbiAgICAgICAgZW52aXJvbm1lbnRbMl0gPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJCYWNrV2FsbFwiLCBtYXRlcmlhbEVudmlyb25tZW50LCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5HUk9VUF8yKTtcclxuICAgICAgICBlbnZpcm9ubWVudFsyXS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDIwLCAxLCAxKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMl0ubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMCwgMC41LCAtMTAuNSkpO1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChlbnZpcm9ubWVudFsyXSk7XHJcblxyXG4gICAgICAgIGVudmlyb25tZW50WzNdID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiTGVmdFdhbGxcIiwgbWF0ZXJpYWxFbnZpcm9ubWVudCwgbmV3IGYuTWVzaEN1YmUoKSwgMCwgZi5QSFlTSUNTX1RZUEUuU1RBVElDLCBmLlBIWVNJQ1NfR1JPVVAuR1JPVVBfMik7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbM10ubXR4TG9jYWwuc2NhbGUobmV3IGYuVmVjdG9yMygxLCAxLCAyMCkpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzNdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDEwLjUsIDAuNSwgMCkpO1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChlbnZpcm9ubWVudFszXSk7XHJcblxyXG4gICAgICAgIGVudmlyb25tZW50WzRdID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiUmlnaHRXYWxsXCIsIG1hdGVyaWFsRW52aXJvbm1lbnQsIG5ldyBmLk1lc2hDdWJlKCksIDAsIGYuUEhZU0lDU19UWVBFLlNUQVRJQywgZi5QSFlTSUNTX0dST1VQLkdST1VQXzIpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzRdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMSwgMSwgMjApKTtcclxuICAgICAgICBlbnZpcm9ubWVudFs0XS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygtMTAuNSwgMC41LCAwKSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzRdKTtcclxuXHJcbiAgICAgICAgLy9Hb2FsXHJcbiAgICAgICAgZW52aXJvbm1lbnRbNV0gPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJHb2FsX1VwcGVyXCIsIG1hdGVyaWFsR29hbCwgbmV3IGYuTWVzaEN1YmUoKSwgMCwgZi5QSFlTSUNTX1RZUEUuU1RBVElDLCBmLlBIWVNJQ1NfR1JPVVAuR1JPVVBfMik7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbNV0ubXR4TG9jYWwuc2NhbGUobmV3IGYuVmVjdG9yMyg4LCAxLCAxKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbNV0ubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoMCwgNC41LCAtOS41KSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzVdKTtcclxuXHJcbiAgICAgICAgZW52aXJvbm1lbnRbNl0gPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJHb2FsX0xlZnRcIiwgbWF0ZXJpYWxHb2FsLCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5HUk9VUF8yKTtcclxuICAgICAgICBlbnZpcm9ubWVudFs2XS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDEsIDQuNSwgMSkpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzZdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKC00LjUsIDAuNSwgLTkuNSkpO1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChlbnZpcm9ubWVudFs2XSk7XHJcblxyXG4gICAgICAgIGVudmlyb25tZW50WzddID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiR29hbF9SaWdodFwiLCBtYXRlcmlhbEdvYWwsIG5ldyBmLk1lc2hDdWJlKCksIDAsIGYuUEhZU0lDU19UWVBFLlNUQVRJQywgZi5QSFlTSUNTX0dST1VQLkdST1VQXzIpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzddLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMSwgNC41LCAxKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbN10ubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoNC41LCAwLjUsIC05LjUpKTtcclxuICAgICAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoZW52aXJvbm1lbnRbN10pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNldHRpbmdVcFRyaWdnZXIoKSB7XHJcbiAgICAgICAgLy8gQmFsbCBSZXNldHRpbmcgVHJpZ2dlcnNcclxuICAgICAgICBlbnZpcm9ubWVudFs4XSA9IGNyZWF0ZU5vZGVXaXRoQ29tcG9uZW50cyhcIkdyb3VuZF9CZWxvd1plcm9cIiwgbWF0ZXJpYWxHb2FsLCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5UUklHR0VSKTtcclxuICAgICAgICBlbnZpcm9ubWVudFs4XS5yZW1vdmVDb21wb25lbnQoZW52aXJvbm1lbnRbOF0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50TWVzaCkpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzhdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMTAwLCAxMCwgMTAwKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbOF0ubXR4TG9jYWwudHJhbnNsYXRlWSgtMSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzhdKTtcclxuXHJcbiAgICAgICAgZW52aXJvbm1lbnRbOV0gPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJHb2FsX1RyaWdnZXJcIiwgbWF0ZXJpYWxHb2FsLCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLlBIWVNJQ1NfVFlQRS5TVEFUSUMsIGYuUEhZU0lDU19HUk9VUC5UUklHR0VSKTtcclxuICAgICAgICBlbnZpcm9ubWVudFs5XS5yZW1vdmVDb21wb25lbnQoZW52aXJvbm1lbnRbOV0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50TWVzaCkpO1xyXG4gICAgICAgIGVudmlyb25tZW50WzldLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoOSwgNC41LCAxLjUpKTtcclxuICAgICAgICBlbnZpcm9ubWVudFs5XS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLCAwLjUsIC02LjI1KSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzldKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZXNldEJhbGwoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcykge1xyXG4gICAgICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5LmdldENvbnRhaW5lcigpLm5hbWUgPT0gXCJCYWxsXCIpIHtcclxuICAgICAgICAgICAgYmFsbEJvZHkuc2V0VmVsb2NpdHkoZi5WZWN0b3IzLlpFUk8oKSk7XHJcbiAgICAgICAgICAgIGJhbGxCb2R5LnNldEFuZ3VsYXJWZWxvY2l0eShmLlZlY3RvcjMuWkVSTygpKTtcclxuICAgICAgICAgICAgYmFsbEJvZHkuc2V0UG9zaXRpb24obmV3IGYuVmVjdG9yMygwLCA1LCAwKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNldHRpbmdVcEFKb2ludCgpIHtcclxuICAgICAgICBlbnZpcm9ubWVudFsxMF0gPSBjcmVhdGVOb2RlV2l0aENvbXBvbmVudHMoXCJIb2xkZXJcIiwgbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMC40LCAwLjQsIDAuNCwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5QSFlTSUNTX1RZUEUuU1RBVElDLCBmLlBIWVNJQ1NfR1JPVVAuR1JPVVBfMSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGVudmlyb25tZW50WzEwXSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMTBdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDUsIDYsIC0yKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMTBdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMC41LCAxLCAwLjUpKTtcclxuXHJcbiAgICAgICAgZW52aXJvbm1lbnRbMTFdID0gY3JlYXRlTm9kZVdpdGhDb21wb25lbnRzKFwiTW92aW5nRHJpbGxcIiwgbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdENvbG9yZWQobmV3IGYuQ29sb3IoMSwgMSwgMCwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5QSFlTSUNTX1RZUEUuRFlOQU1JQywgZi5QSFlTSUNTX0dST1VQLkdST1VQXzEpO1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChlbnZpcm9ubWVudFsxMV0pO1xyXG4gICAgICAgIGVudmlyb25tZW50WzExXS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMyg1LCAyLjUsIC0yKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMTFdLm10eExvY2FsLnNjYWxlKG5ldyBmLlZlY3RvcjMoMywgMiwgMC4yKSk7XHJcbiAgICAgICAgbGV0IGN5bGluZHJpY2FsSm9pbnQgPSBuZXcgZi5Db21wb25lbnRKb2ludEN5bGluZHJpY2FsKGVudmlyb25tZW50WzEwXS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLCBlbnZpcm9ubWVudFsxMV0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KSwgbmV3IGYuVmVjdG9yMygwLCAxLCAwKSk7XHJcbiAgICAgICAgZW52aXJvbm1lbnRbMTFdLmFkZENvbXBvbmVudChjeWxpbmRyaWNhbEpvaW50KTtcclxuICAgICAgICBjeWxpbmRyaWNhbEpvaW50LnRyYW5zbGF0aW9uTW90b3JMaW1pdExvd2VyID0gLTE7XHJcbiAgICAgICAgY3lsaW5kcmljYWxKb2ludC50cmFuc2xhdGlvbk1vdG9yTGltaXRVcHBlciA9IDA7XHJcbiAgICB9XHJcbn1cclxuXHJcbiJdfQ==